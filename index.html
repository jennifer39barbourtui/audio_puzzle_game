<!DOCTYPE html>

<html>
<!-- <html dir="rtl"> -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.88.1">
    <title>נו זה זה!</title>

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="/docs/5.1/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="/docs/5.1/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/docs/5.1/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="manifest" href="/docs/5.1/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="/docs/5.1/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
    <link rel="icon" href="/docs/5.1/assets/img/favicons/favicon.ico">
    <meta name="theme-color" content="#7952b3">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎧</text></svg>">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Or for RTL support -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" /> -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <!-- Or for RTL support -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css" /> -->

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="px-3 d-flex align-items-stretch">
        <div class="container-fluid d-flex align-items-center p-3 border-bottom">
            <div class="d-flex align-items-center fs-4 mb-0">
                <img src="./svgs/solid/gear.svg" width="20" class="">
                <img src="./svgs/solid/share-nodes.svg" width="20" class="ms-2">
            </div>
            <h1 class="m-auto">נו זה זה!</h1>
            <div class="d-flex align-items-center fs-4 mb-0">
                <img src="./svgs/solid/signal.svg" width="20" class="">
                <img src="./svgs/solid/question.svg" width="20" class="ms-2">
            </div>
        </div>
    </header>

    <div class="container-fluid px-3">
        <div class="d-flex justify-content-center text-center">
            <div class="py-3 d-flex align-items-center">
                <img src="./svgs/solid/gifts.svg" width="20">
                <span class="mx-2 my-auto">Guess the song played by the band</span>
                <img src="./svgs/solid/gifts.svg" width="20">
            </div>
        </div>
        <div class="row row-cols-1 g-2 song-list">
            <div class="col">
                <div class="bg-warning bg-gradient">1 - Bells 1</div>
            </div>
            <div class="col">
                <div class="bg-warning bg-gradient">2 - Bass</div>
            </div>
            <div class="col">
                <div class="bg-warning bg-gradient">3 - Piano</div>
            </div>
            <div class="col">
                <div class="bg-warning bg-gradient">4 - Synth 1 + Bells 2</div>
            </div>
            <div class="col selected">
                <div class="bg-warning bg-gradient">5 - Synth 2</div>
            </div>
            <div class="col">
                <div class="bg-warning bg-gradient">6 - Get a club</div>
            </div>
        </div>
        <div class="audio-player-container mt-4 position-relative">
            <div class="text-center">
                <button class="border"><img src="./svgs/solid/play.svg" width="20"></button>
            </div>
            <div class="d-flex">
                <audio src=”my-favourite-song.mp3” preload=”metadata”></audio>
                <progress id="audio_handle" value="32" max="100" class="w-100 mt-3"></progress>
            </div>
            <div class="mt-3">
                <select class="form-select" id="song_list" data-placeholder="Recognize it? Type the artist name or title">
                    <option></option>
                    <option>Reactive</option>
                    <option>Solution</option>
                    <option>Conglomeration</option>
                    <option>Algoritm</option>
                    <option>Holistic</option>
                </select>
            </div>
            <div class="d-flex justify-content-between mt-3">
                <button class="btn btn-danger">
                    SKIP
                </button>
                <img src="./svgs/solid/puzzle-piece.svg" width="30">
                <button class="btn btn-success">
                    GUESS
                </button>
            </div>
        </div>
    </div>



    <h1>🎧 נו זה זה!</h1>

    <div>
        <span id="display">...</span>
    </div>

    <div>
        <span id="guessCounter">⬜️ ⬜️ ⬜️ ⬜️ ⬜️ ⬜️</span>
    </div>

    <div>
        <input id="volumeSlider" type="range" min="1" max="100" value="25">
        <button id="skipButton" disabled>skip +1s</button>
        <button id="stopButton" disabled>stop</button>
        <button id="playButton" disabled>play</button>
    </div>

    <div>
        <input id="guessInput" list="songsList" name="song" autocomplete="off">
        <datalist id="songsList"></datalist>
        <button id="guessButton" disabled>guess</button>
    </div>

    <div hidden>
        <div>
            <iframe id="player" allow="autoplay" height="0" src="https://w.soundcloud.com/player/?url=https://soundcloud.com/rick-astley-official/never-gonna-give-you-up"></iframe>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://w.soundcloud.com/player/api.js"></script>

    <script>
        $('#song_list').select2({
            theme: "bootstrap-5",
            width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
            placeholder: $(this).data('placeholder'),
        });
    </script>
    <script>
        let display = document.getElementById("display");
        let guessCounter = document.getElementById("guessCounter");
        let volumeSlider = document.getElementById("volumeSlider");
        let skipButton = document.getElementById("skipButton");
        let stopButton = document.getElementById("stopButton");
        let playButton = document.getElementById("playButton");
        let songsList = document.getElementById("songsList");
        let guessInput = document.getElementById("guessInput");
        let guessButton = document.getElementById("guessButton");
        let sc = SC.Widget('player');

        let guesses = [];
        let currentGuess = 0;
        let score = [null, null, null, null, null, null];
        let totalSeconds = [2, 3, 5, 8, 12, 16];
        var playerTimeout = null;
        let songSet = (new URLSearchParams(window.location.search)).get('songs') || 'default';
        var songs = [];
        var song = {};

        sc.bind(SC.Widget.Events.READY, () => {
            skipButton.disabled = false;
            playButton.disabled = false;
            sc.setVolume(25);
        });

        let disableInputs = () => {
            skipButton.disabled = true;
            playButton.disabled = true;
            guessInput.disabled = true;
            guessButton.disabled = true;
        };

        let enableInputs = () => {
            skipButton.disabled = false;
            stopButton.disabled = false;
            playButton.disabled = false;
            guessInput.disabled = false;
            guessButton.disabled = false;
        };

        let checkEndGame = () => {
            if (currentGuess == 6) {
                disableInputs();
                display.innerHTML = ' לא הצלחתם לנחש את ' + song.string;
                sc.pause();
                sc.seekTo(0);
                sc.play();
            } else {
                if (currentGuess == 5) {
                    skipButton.innerHTML = 'skip';
                } else {
                    skipButton.innerHTML = `skip +${(totalSeconds[currentGuess+1] - totalSeconds[currentGuess])}s`;
                }
            }
        }

        let updateGuesses = () => {
            // display.innerHTML = '';
            // guesses.forEach((guess) => {
            //     display.innerHTML += `${guess}</br>`;
            // });

            var scoreString = '';
            score.forEach((guess) => {
                if (guess === null) {
                    scoreString += ' ⬜️'
                } else if (guess === true) {
                    scoreString += ' 🟩'
                } else if (guess === false) {
                    scoreString += ' 🟥'
                }
            });
            guessCounter.innerHTML = scoreString;
        };

        volumeSlider.oninput = (e) => {
            sc.setVolume(e.target.value);
        };

        skipButton.onclick = () => {
            guesses[currentGuess] = 'SKIPPED';
            score[currentGuess++] = false;
            updateGuesses();
            checkEndGame();
        };

        stopButton.onclick = () => {
            clearTimeout(playerTimeout);
            sc.pause();
            sc.seekTo(0);
            enableInputs();
            stopButton.disabled = true;
        };

        playButton.onclick = () => {
            disableInputs();
            stopButton.disabled = false;
            sc.play();

            playerTimeout = setTimeout(() => {
                sc.pause();
                sc.seekTo(0);
                enableInputs();
                stopButton.disabled = true;
            }, (totalSeconds[currentGuess] * 1000));
        };

        fetch(`https://raw.githubusercontent.com/milmanal/nuzeze/main/israeli/israeli_ariel_playlist.json`)
            .then(response => response.json())
            .then((json) => {
                songs = json.sort((a, b) => 0.5 - Math.random());
                song = songs[Math.floor(Math.random() * songs.length)];
                songs.forEach((song) => {
                    let option = document.createElement('option');
                    option.value = song.string;
                    songsList.appendChild(option);
                })
                sc.load(song.url);
            });

        guessInput.oninput = (e) => {            
            if (songs.map(song => song.string).includes(guessInput.value)) {
                guessButton.disabled = false;
            } else {
                guessButton.disabled = true;
            }
        };

        guessButton.onclick = () => {
            guesses[currentGuess] = guessInput.value;

            if (song.string === guessInput.value) {
                score[currentGuess] = true;
                display.innerHTML = ' אלופים! ניחשתם את ' + song.string;
                sc.pause();
                sc.seekTo(0);
                sc.play();
                disableInputs();
                //currentGuess = 6;
            } else {
                score[currentGuess++] = false;
                guessInput.value = '';
                guessButton.disabled = true;
            }

            updateGuesses();
            checkEndGame();
        };
    </script>
</body>
</html>