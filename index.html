<!DOCTYPE html>

<!-- <html> -->
<html dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.88.1">
    <title>נו זה זה!</title>

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="/docs/5.1/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="/docs/5.1/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/docs/5.1/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="manifest" href="/docs/5.1/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="/docs/5.1/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
    <link rel="icon" href="/docs/5.1/assets/img/favicons/favicon.ico">
    <meta name="theme-color" content="#7952b3">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎧</text></svg>">

    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" /> -->
    <!-- Or for RTL support -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" id="rtl_bootstrap_css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" /> -->
    <!-- Or for RTL support -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css" id="rtl_theme_css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="fixed-mobile-resolution container-fluid px-3 d-flex align-items-stretch">
        <div class="container-fluid d-flex align-items-center p-3 border-bottom">
            <div class="d-flex align-items-center fs-4 mb-0">
                <img src="./svgs/solid/gear.svg" height="20" class="">
                <img src="./svgs/solid/share-nodes.svg" height="20" class="ms-2">
            </div>
            <h1 class="m-auto">נו זה זה!</h1>
            <div class="d-flex align-items-center fs-4 mb-0">
                <img src="./svgs/solid/signal.svg" height="20" class="">
                <img src="./svgs/solid/question.svg" height="20" class="ms-2">
            </div>
        </div>
    </header>

    <div class="fixed-mobile-resolution container-fluid px-3">
        <div class="d-flex justify-content-center text-center position-relative" style="font-size: .8rem;">
            <div class="py-3 d-flex align-items-center">
                <img src="./svgs/solid/gifts.svg" width="20" class="d-none">
                <span class="mx-2 my-auto">Guess the song played by the band</span>
                <img src="./svgs/solid/gifts.svg" width="20" class="d-none">
            </div>
            <div class="position-absolute end-0 top-50">
                <div class="form-check form-switch translate-middle-y">
                    <input class="form-check-input" type="checkbox" name="rtl_radio" id="rtl_radio" checked>
                    <label class="form-check-label" for="rtl_radio">RTL</label>
                </div>
            </div>
        </div>
        <div class="row row-cols-1 g-2" id="song_list_guessing">
            <div class="col">
                <div class="bg-warning bg-gradient">1 - 2s Play</div>
            </div>
            <div class="col">
                <div class="bg-warning bg-gradient">2 - 3s Play</div>
            </div>
            <div class="col">
                <div class="bg-warning bg-gradient">3 - 5s Play</div>
            </div>
            <div class="col">
                <div class="bg-warning bg-gradient">4 - 8s Play</div>
            </div>
            <div class="col">
                <div class="bg-warning bg-gradient">5 - 12s Play</div>
            </div>
            <div class="col">
                <div class="bg-warning bg-gradient">6 - 16s Play</div>
            </div>
            <div class="col" hidden>
                <div class="bg-warning bg-gradient">result</div>
            </div>
        </div>
        <div class="fixed-mobile-resolution container-fluid audio-player-container mt-4">
            <div class="text-center">
                <button class="btn btn-outline-secondary rounded-pill px-4" id="play_button"><img src="./svgs/solid/play.svg" width="20"></button>
            </div>
            <div class="d-none" id="play_panel">
                <div class="d-flex">
                    <audio src="" preload=”metadata”></audio>
                    <progress id="audio_handle" value="0" max="100" class="w-100 mt-3"></progress>
                </div>
                <div class="mt-3">
                    <select class="form-select" id="song_list" data-placeholder="Recognize it? Type the artist name or title">
                        <option></option>
                    </select>
                </div>
                <div class="d-flex justify-content-between mt-3">
                    <button class="btn btn-danger" id="skip_button">
                        SKIP
                    </button>
                    <img src="./svgs/solid/puzzle-piece.svg" width="30">
                    <button class="btn btn-success" id="guess_button">
                        GUESS
                    </button>
                </div>
            </div>
        </div>

        <div class="mt-4 border-top border-2 border-primary py-3 text-center d-none" id="result_panel">
        </div>
    </div>

    <div class="fixed-mobile-resolution fixed-bottom container-fluid d-flex justify-content-center">
        <div class="bg-danger d-flex text-white p-1 mb-2 rounded-3" style="min-width: 360px;">
            <div class="my-auto">
                <img class="me-2" src="./mark.png" alt="">
            </div>
            <div>
                <div class="fs-5">Bandle, the App is finally here!</div>
                <div id="notify_text">
                    <div class="d-none">Download it know from the play store</div>
                    <div class="d-none">Play over 500 songs</div>
                    <div class="d-none">6 bounds rounds to test your music knowledge</div>
                    <div class="d-none">Fan party game for evenings with Friends!</div>
                </div>
            </div>
        </div>
    </div>

    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11;">
        <div id="available_skip" class="toast align-items-center" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body border-start border-3 border-primary">
                    If you don't recognize the song, press SKIP to hear more instruments
                </div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11;">
        <div id="select_song" class="toast align-items-center" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body border-start border-3 border-danger">
                    Select song please
                </div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <div hidden>
        <div>
            <iframe id="player" allow="autoplay" height="0add" src="https://w.soundcloud.com/player/?url=https://soundcloud.com/rick-astley-official/never-gonna-give-you-up"></iframe>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://w.soundcloud.com/player/api.js"></script>

    <script>
        $('#song_list').select2({
            theme: "bootstrap-5",
            width: $(this).data('width') ? $(this).data('width') : $(this).hasClass('w-100') ? '100%' : 'style',
            placeholder: $(this).data('placeholder'),
        });
        
    </script>
    <script>
        const songListElement = document.getElementById('song_list');
        const availableToast = new bootstrap.Toast(document.getElementById('available_skip'));
        const selectSongToast = new bootstrap.Toast(document.getElementById('select_song'));
        const guessingElementList = document.getElementById('song_list_guessing').children;
        const skipButton_temp = document.getElementById('skip_button');
        const guessButton_temp = document.getElementById('guess_button');
        const resultElement = document.getElementById('result_panel');
        const playButton = document.getElementById('play_button');
        const notifyText = document.getElementById('notify_text');
        const progressBar = document.getElementById('audio_handle');
        const playPanel = document.getElementById('play_panel');
        const rtlSwitch = document.getElementById('rtl_radio');

        const sc_temp = SC.Widget('player');
        sc_temp.bind(SC.Widget.Events.READY, () => {
            sc_temp.setVolume(25);
        });

        let selectedSong, playerTimeout_temp, playerPosition, scores=[];
        const stepSeconds = [2, 3, 5, 8, 12, 16];
        let currentStep = -1;
        stepSeconds.forEach((second, step) => {
            if (!guessingElementList[step]) return;

            guessingElementList[step].dataset.second = second;
            guessingElementList[step].addEventListener('click', onClickPlay);

            guessingElementList[step].children[0].textContent = `${step + 1} - ${second}s Play`;
        });

        skipButton_temp.addEventListener('click', async function() {
            if (stepSeconds.length <= currentStep) return;

            const result = await b_confirm('Would you skip this?');

            if (result)
                nextStepWithResult();
        })

        guessButton_temp.addEventListener('click', async function() {
            if (stepSeconds.length <= currentStep) return;

            if (!songListElement.value) {
                selectSongToast.show();
                return;
            }

            const result = await b_confirm('Are you sure?');

            if (result) {
                nextStepWithResult(selectedSong.string === songListElement.value);
            }
        })

        playButton.addEventListener('click', function() {
            if (playerTimeout_temp)
                stopSound();
            else
                playSound(stepSeconds[currentStep]);
        })

        rtlSwitch.addEventListener('change', function() {
            const currentBootstrapId = this.checked ? 'ltr_bootstrap_css' : 'rtl_bootstrap_css';
            const bootstrapId = this.checked ? 'rtl_bootstrap_css' : 'ltr_bootstrap_css';
            const bootstrapHref = this.checked ?
                'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.rtl.min.css' :
                'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css';

            const currentThemeId = this.checked ? 'ltr_theme_css' : 'rtl_theme_css';
            const themeId = this.checked ? 'rtl_theme_css' : 'ltr_theme_css';
            const themeHref = this.checked ?
                'https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css' :
                'https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css';

            loadCss(bootstrapId, bootstrapHref);
            loadCss(themeId, themeHref);
            removeElement(currentBootstrapId);
            removeElement(currentThemeId);

            document.dir = this.checked ? 'rtl' : 'ltr';
        })

        async function b_confirm(msg) {
            const modalElem = document.createElement('div')
            modalElem.id = "modal-confirm"
            modalElem.className = "modal"
            modalElem.innerHTML = `
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">             
                    <div class="modal-body">
                        ${msg}
                    </div>    <!-- modal-body -->
                <div class="modal-footer" style="border-top:0px">             
                    <button id="modal-btn-descartar" type="button" class="btn btn-secondary">Cancel</button>
                    <button id="modal-btn-aceptar" type="button" class="btn btn-primary">Accept</button>
                </div>
                </div>
            </div>
            `
            const myModal = new bootstrap.Modal(modalElem, {
                keyboard: false,
                backdrop: 'static'
            })
            myModal.show()

            return new Promise((resolve, reject) => {
                document.body.addEventListener('click', response)

                function response(e) {
                    let bool = false
                    if (e.target.id == 'modal-btn-descartar') bool = false
                    else if (e.target.id == 'modal-btn-aceptar') bool = true
                    else return

                    document.body.removeEventListener('click', response)
                    document.body.querySelector('.modal-backdrop').remove()
                    modalElem.remove()
                    resolve(bool)
                }
            })
        }

        function removeElement(id) {
            const element = document.getElementById(id);
            element.remove();
        }

        function loadCss(id, href) {
            var head = document.getElementsByTagName('head')[0];

            // Creating link element 
            var style = document.createElement('link');
            style.id = id;
            style.href = href;
            style.type = 'text/css';
            style.rel = 'stylesheet';
            head.append(style);
        }

        function loadJS(id, src) {
            // Head tag 
            var head = document.getElementsByTagName('head')[0]

            // Creating script element 
            var script = document.createElement('script')
            script.id = id
            script.src = src
            script.type = 'text/javascript'

            // Adding script element 
            head.append(script)
        }

        function loopNotifyText(element, firstElement) {
            animateText(element).then(() => {
                loopNotifyText(element.nextElementSibling ?? firstElement, firstElement);
            })
        }

        function animateText(element, delay = 3) {
            element.classList.remove(`d-none`);
            return new Promise(resolve => {
                animateCSS(element, 'fadeIn').then(() => {
                    element.classList.add(`animate__delay-${delay}s`);
                    animateCSS(element, 'fadeOut').then(() => {
                        element.classList.remove(`animate__delay-${delay}s`);
                        element.classList.add(`d-none`);
                        resolve();
                    })
                })
            })
        }

        function animateCSS (element, animation, prefix = 'animate__') {
            // We create a Promise and return it
            return new Promise((resolve, reject) => {
                const animationName = `${prefix}${animation}`;

                element.classList.add(`${prefix}animated`, animationName);

                // When the animation ends, we clean the classes and resolve the Promise
                function handleAnimationEnd(event) {
                    event.stopPropagation();
                    element.classList.remove(`${prefix}animated`, animationName);
                    resolve('Animation ended');
                }

                element.addEventListener('animationend', handleAnimationEnd, { once: true });
            });
        }

        function nextStepWithResult(result) {
            if (stepSeconds.length <= currentStep) return;

            if (currentStep > -1) {
                scores[currentStep] = result;
                guessingElementList[currentStep].classList.remove('selected');
                if (result) {
                    guessingElementList[currentStep].classList.add('text-success');
                }
            }

            if (result) {
                resultElement.classList.remove('d-none');
                resultElement.textContent = ` לא הצלחתם לנחש את ${song.string}`;
                Promise.all([animateCSS(resultElement, 'fadeIn')]);
                return;
            }

            currentStep ++;
            guessingElementList[currentStep].classList.add('selected');

            if (currentStep == stepSeconds.length) {
                // 6 step failed
                resultElement.classList.remove('d-none');
                resultElement.textContent = scores.findIndex(score => score === false) > -1 ? `Guessing Failed` : `Skiped All`;
                Promise.all([animateCSS(resultElement, 'fadeIn')]);
            }
        }

        function onClickPlay() {
            if (this?.dataset?.second) {
                if (this.dataset.second > stepSeconds[currentStep]) {
                    availableToast.show();
                    return;
                }
                playSound(this.dataset.second);
            } else {
                playSound(stepSeconds[currentStep]);
            }
        }

        function stopSound() {
            sc_temp.pause();
            sc_temp.seekTo(0);
            clearInterval(playerPosition);
            playerPosition = null;
            clearTimeout(playerTimeout_temp);
            playerTimeout_temp = null;

            const image = document.createElement('img');
            image.src = `./svgs/solid/play.svg`;
            image.width = 20;
            this.innerHTML = image.outerHTML;
        }

        function playSound(second) {
            if (playerTimeout_temp) return;

            if (playPanel.classList.contains('d-none')) {
                playPanel.classList.remove('d-none');
                Promise.all([animateCSS(playPanel, 'fadeIn')]);
            }

            console.log('here', selectedSong.string, second * 1000);
            sc_temp.play();

            let time = 0;
            progressBar.value = time;
            playerPosition = setInterval(() => {
                time += 100;
                progressBar.value = time * 100 / (second * 1000);
            }, 100)

            const image = document.createElement('img');
            image.src = `./svgs/solid/pause.svg`;
            image.width = 20;
            this.innerHTML = image.outerHTML;

            playerTimeout_temp = setTimeout(() => {
                stopSound();
            }, second * 1000);
        }

        function getSongList() {
            return new Promise(resolve => {
                fetch(`https://raw.githubusercontent.com/milmanal/nuzeze/main/israeli/israeli_ariel_playlist.json`)
                    .then(response => response.json())
                    .then((json) => {
                        resolve(json.sort((a, b) => 0.5 - Math.random()))
                    })
            })
        }

        nextStepWithResult();
        loopNotifyText(notifyText.children[0], notifyText.children[0]);

        $(function() {
            getSongList().then(songs => {
                songs.forEach(song => {
                    const option = document.createElement('option');
                    option.textContent = song.string;
                    songListElement.appendChild(option);
                })

                selectedSong = songs[Math.floor(Math.random() * songs.length)];
                sc_temp.load(selectedSong.url);
            })
        })
    </script>


    <!-- <script>
        let display = document.getElementById("display");
        let guessCounter = document.getElementById("guessCounter");
        let volumeSlider = document.getElementById("volumeSlider");
        let skipButton = document.getElementById("skipButton");
        let stopButton = document.getElementById("stopButton");
        let playButton = document.getElementById("playButton");
        let songsList = document.getElementById("songsList");
        let guessInput = document.getElementById("guessInput");
        let guessButton = document.getElementById("guessButton");
        let sc = SC.Widget('player');

        let guesses = [];
        let currentGuess = 0;
        let score = [null, null, null, null, null, null];
        let totalSeconds = [2, 3, 5, 8, 12, 16];
        var playerTimeout = null;
        let songSet = (new URLSearchParams(window.location.search)).get('songs') || 'default';
        var songs = [];
        var song = {};

        sc.bind(SC.Widget.Events.READY, () => {
            skipButton.disabled = false;
            playButton.disabled = false;
            sc.setVolume(25);
        });

        let disableInputs = () => {
            skipButton.disabled = true;
            playButton.disabled = true;
            guessInput.disabled = true;
            guessButton.disabled = true;
        };

        let enableInputs = () => {
            skipButton.disabled = false;
            stopButton.disabled = false;
            playButton.disabled = false;
            guessInput.disabled = false;
            guessButton.disabled = false;
        };

        let checkEndGame = () => {
            if (currentGuess == 6) {
                disableInputs();
                display.innerHTML = ' לא הצלחתם לנחש את ' + song.string;
                sc.pause();
                sc.seekTo(0);
                sc.play();
            } else {
                if (currentGuess == 5) {
                    skipButton.innerHTML = 'skip';
                } else {
                    skipButton.innerHTML = `skip +${(totalSeconds[currentGuess+1] - totalSeconds[currentGuess])}s`;
                }
            }
        }

        let updateGuesses = () => {
            // display.innerHTML = '';
            // guesses.forEach((guess) => {
            //     display.innerHTML += `${guess}</br>`;
            // });

            var scoreString = '';
            score.forEach((guess) => {
                if (guess === null) {
                    scoreString += ' ⬜️'
                } else if (guess === true) {
                    scoreString += ' 🟩'
                } else if (guess === false) {
                    scoreString += ' 🟥'
                }
            });
            guessCounter.innerHTML = scoreString;
        };

        volumeSlider.oninput = (e) => {
            sc.setVolume(e.target.value);
        };

        skipButton.onclick = () => {
            guesses[currentGuess] = 'SKIPPED';
            score[currentGuess++] = false;
            updateGuesses();
            checkEndGame();
        };

        stopButton.onclick = () => {
            clearTimeout(playerTimeout);
            sc.pause();
            sc.seekTo(0);
            enableInputs();
            stopButton.disabled = true;
        };

        playButton.onclick = () => {
            disableInputs();
            stopButton.disabled = false;
            sc.play();

            playerTimeout = setTimeout(() => {
                sc.pause();
                sc.seekTo(0);
                enableInputs();
                stopButton.disabled = true;
            }, (totalSeconds[currentGuess] * 1000));
        };

        fetch(`https://raw.githubusercontent.com/milmanal/nuzeze/main/israeli/israeli_ariel_playlist.json`)
            .then(response => response.json())
            .then((json) => {
                songs = json.sort((a, b) => 0.5 - Math.random());
                song = songs[Math.floor(Math.random() * songs.length)];
                songs.forEach((song) => {
                    let option = document.createElement('option');
                    option.value = song.string;
                    songsList.appendChild(option);
                })
                sc.load(song.url);
            });

        guessInput.oninput = (e) => {            
            if (songs.map(song => song.string).includes(guessInput.value)) {
                guessButton.disabled = false;
            } else {
                guessButton.disabled = true;
            }
        };

        guessButton.onclick = () => {
            guesses[currentGuess] = guessInput.value;

            if (song.string === guessInput.value) {
                score[currentGuess] = true;
                display.innerHTML = ' אלופים! ניחשתם את ' + song.string;
                sc.pause();
                sc.seekTo(0);
                sc.play();
                disableInputs();
                //currentGuess = 6;
            } else {
                score[currentGuess++] = false;
                guessInput.value = '';
                guessButton.disabled = true;
            }

            updateGuesses();
            checkEndGame();
        };
    </script> -->
</body>
</html>